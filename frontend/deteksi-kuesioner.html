<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deteksi Depresi - Kuesioner - SADAR</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap");
    body {
      font-family: "Inter", sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="flex min-h-screen">
    <aside class="w-64 bg-white border-r border-gray-200 fixed h-full">
      <div class="p-6">
        <div class="flex items-center space-x-2 mb-10">
          <img src="img/log.png" alt="SADAR Logo" class="h-8" />
          <span class="text-xl font-bold text-gray-800">SADAR</span>
        </div>
        <nav class="space-y-2">
          <a href="dashboard.html"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 font-medium">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span>Dashboard</span>
          </a>
          <a href="deteksi-depresi.html"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg bg-blue-50 text-blue-600 font-medium">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>Deteksi Depresi</span>
          </a>
          <a href="riwayat-deteksi.html"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 font-medium">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <span>Riwayat Deteksi</span>
          </a>
          <a href="pengaturan.html"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 font-medium">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>Pengaturan</span>
          </a>
          <button onclick="confirmLogout()"
            class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 font-medium">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1" />
            </svg>
            <span>Logout</span>
          </button>
        </nav>
      </div>
    </aside>
    <main class="flex-1 ml-64">
      <header class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="px-8 py-4 flex items-center justify-between">
          <h1 class="text-3xl font-bold text-gray-800">Deteksi Depresi</h1>
          <div class="flex items-center space-x-4">
            <div class="flex items-center space-x-3">
              <span id="userName" class="text-sm font-medium text-gray-700">-</span>
              <img id="userAvatar" src="https://ui-avatars.com/api/?name=User&background=ec4899&color=fff"
                alt="User Avatar" class="w-10 h-10 rounded-full" />
            </div>
          </div>
        </div>
      </header>
      <div class="p-8">
        <div class="max-w-5xl mx-auto">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2">
              <div class="bg-white rounded-2xl shadow-sm p-8 border border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">
                  <span id="qTitle">Pertanyaan 1</span>
                </h2>
                <p class="text-gray-600 mb-8">
                  <span id="qText"></span>
                </p>
                <div class="space-y-4" id="options">
                  <label class="flex items-center space-x-3 cursor-pointer">
                    <input type="radio" name="answer" value="3" class="w-5 h-5 text-blue-600 focus:ring-blue-500" />
                    <span class="text-gray-700 font-medium">Hampir Setiap Hari</span>
                  </label>
                  <label class="flex items-center space-x-3 cursor-pointer">
                    <input type="radio" name="answer" value="2" class="w-5 h-5 text-blue-600 focus:ring-blue-500" />
                    <span class="text-gray-700 font-medium">Lebih dari Separuh Hari</span>
                  </label>
                  <label class="flex items-center space-x-3 cursor-pointer">
                    <input type="radio" name="answer" value="1" class="w-5 h-5 text-blue-600 focus:ring-blue-500" />
                    <span class="text-gray-700 font-medium">Beberapa Hari</span>
                  </label>
                  <label class="flex items-center space-x-3 cursor-pointer">
                    <input type="radio" name="answer" value="0" class="w-5 h-5 text-blue-600 focus:ring-blue-500" />
                    <span class="text-gray-700 font-medium">Tidak Pernah</span>
                  </label>
                </div>
                <div class="flex items-center justify-between mt-12">
                  <button id="btnBack" class="px-6 py-2 text-purple-600 font-semibold hover:text-purple-700 transition">
                    &lt; Kembali
                  </button>
                  <button id="btnNext"
                    class="px-8 py-3 bg-[#9090F4] text-white rounded-lg font-semibold hover:bg-[#7a7ae0] transition shadow-lg">
                    Selanjutnya
                  </button>
                </div>
              </div>
            </div>
            <div class="lg:col-span-1">
              <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-200 sticky top-24">
                <h3 class="font-bold text-gray-800 mb-6">Progres Kamu</h3>
                <div id="progressGrid" class="grid grid-cols-5 gap-2"></div>
                <p id="progressHint" class="text-xs text-gray-500 mt-4"></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script src="sadar-api.js"></script>
  <script>
    requireAuth();
    const u = getUsername();
    const nameEl = document.getElementById("userName");
    const avatarEl = document.getElementById("userAvatar");
    if (nameEl) nameEl.textContent = u || "-";
    if (avatarEl) {
      avatarEl.src =
        "https://ui-avatars.com/api/?name=" +
        encodeURIComponent(u || "User") +
        "&background=ec4899&color=fff";
    }
  </script>
  <script>
    const QUESTIONS = [
      "Kurang senang atau tertarik dalam kegiatan sehari-hari?",
      "Merasa sedih, muram, dan putus asa?",
      "Sulit tidur atau tidur nyenyak; atau terlalu banyak tidur?",
      "Merasa lelah atau kekurangan energi?",
      "Tidak napsu makan, atau terlalu banyak makan?",
      "Merasa buruk tentang diri sendiri, atau merasa gagal atau mengecewakan diri atau keluargamu?",
      "Kesulitan berkonsentrasi, seperti saat membaca, belajar atau menonton TV?",
      "Bergerak atau berbicara dengan lambat hingga orang lain menyadarinya? Atau merasa kurang istirahat dan tidak bisa diam lebih dari biasanya?",
      "Merasa lebih baik mati, atau berpikir ingin menyakiti diri sendiri?"
    ];
    const demografi = JSON.parse(localStorage.getItem("sadar_demografi") || "null");
    if (!demografi) window.location.href = "deteksi-depresi.html";
    let idx = 0;
    const saved = JSON.parse(localStorage.getItem("sadar_answers") || "[]");
    function buildProgress() {
      const grid = document.getElementById("progressGrid");
      if (!grid) return;
      grid.innerHTML = "";
      QUESTIONS.forEach((_, i) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = String(i + 1);
        btn.className =
          "w-12 h-12 rounded-lg font-semibold transition border-2 " +
          "bg-white border-gray-300 text-gray-700 hover:border-blue-500";
        btn.addEventListener("click", () => {
          idx = i;
          render();
        });
        grid.appendChild(btn);
      });
      const hint = document.getElementById("progressHint");
      if (hint) hint.textContent = `Total pertanyaan: ${QUESTIONS.length}`;
    }
    function setProgressActive() {
      const grid = document.getElementById("progressGrid");
      if (!grid) return;
      const buttons = grid.querySelectorAll("button");
      buttons.forEach((b, i) => {
        const answered = saved[i] !== undefined;
        b.className =
          "w-12 h-12 rounded-lg font-semibold transition border-2 " +
          "bg-white border-gray-300 text-gray-700 hover:border-blue-500";
        if (answered) {
          b.classList.remove("border-gray-300");
          b.classList.add("border-purple-300", "text-purple-700");
        }
        if (i === idx) {
          b.className =
            "w-12 h-12 rounded-lg font-semibold transition border-2 " +
            "bg-blue-500 text-white border-blue-500 hover:bg-blue-600";
        }
      });
    }
    function render() {
      document.getElementById("qTitle").textContent = `Pertanyaan ${idx + 1}`;
      document.getElementById("qText").textContent = QUESTIONS[idx];
      setProgressActive();
      const val = saved[idx];
      document.querySelectorAll("input[name='answer']").forEach((r) => {
        r.checked = val !== undefined && parseInt(r.value) === val;
      });
      const back = document.getElementById("btnBack");
      if (back) back.style.visibility = idx === 0 ? "hidden" : "visible";
      const next = document.getElementById("btnNext");
      if (next) next.textContent = idx === QUESTIONS.length - 1 ? "Selesai" : "Selanjutnya";
    }
    function getSelected() {
      const r = document.querySelector("input[name='answer']:checked");
      return r ? parseInt(r.value) : null;
    }
    document.getElementById("btnBack")?.addEventListener("click", (e) => {
      e.preventDefault();
      if (idx > 0) {
        idx--;
        render();
      }
    });
    document.getElementById("btnNext")?.addEventListener("click", (e) => {
      e.preventDefault();
      const val = getSelected();
      if (val === null) {
        alert("Pilih salah satu jawaban dulu ya ðŸ™‚");
        return;
      }
      saved[idx] = val;
      localStorage.setItem("sadar_answers", JSON.stringify(saved));
      if (idx < QUESTIONS.length - 1) {
        idx++;
        render();
      } else {
        const unanswered = [];
        for (let i = 0; i < QUESTIONS.length; i++) {
          if (saved[i] === undefined || saved[i] === null) {
            unanswered.push(i + 1);
          }
        }
        if (unanswered.length > 0) {
          alert(`Pertanyaan nomor ${unanswered.join(", ")} belum dijawab. Silakan lengkapi semua pertanyaan.`);
          idx = unanswered[0] - 1;
          render();
          return;
        }
        window.location.href = "deteksi-loading.html";
      }
    });
    buildProgress();
    render();
    function confirmLogout() {
      if (confirm("Apakah kamu yakin ingin logout?")) {
        logout();
      }
    }
  </script>
</body>
</html>
