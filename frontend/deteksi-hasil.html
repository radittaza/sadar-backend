<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hasil Deteksi - SADAR</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap");

    body {
      font-family: "Inter", sans-serif;
    }
  </style>
</head>

<body class="bg-gray-50">
  <div class="flex min-h-screen">
    <aside class="w-64 bg-white border-r border-gray-200 fixed h-full">
      <div class="p-6">
        <div class="flex items-center space-x-2 mb-10">
          <img src="img/log.png" alt="SADAR Logo" class="h-8" />
          <span class="text-xl font-bold text-gray-800">SADAR</span>
        </div>
        <nav class="space-y-2">
          <a href="dashboard.html"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 font-medium">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span>Dashboard</span>
          </a>
          <a href="deteksi-depresi.html"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg bg-blue-50 text-blue-600 font-medium">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>Deteksi Depresi</span>
          </a>
          <a href="riwayat-deteksi.html"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 font-medium">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <span>Riwayat Deteksi</span>
          </a>
          <a href="pengaturan.html"
            class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 font-medium">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>Pengaturan</span>
          </a>
          <button onclick="confirmLogout()"
            class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 font-medium">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1" />
            </svg>
            <span>Logout</span>
          </button>
        </nav>
      </div>
    </aside>
    <main class="flex-1 ml-64">
      <header class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="px-8 py-4 flex items-center justify-between">
          <h1 class="text-3xl font-bold text-gray-800">Deteksi Depresi</h1>
          <div class="flex items-center space-x-4">
            <div class="flex items-center space-x-3">
              <span id="userName" class="text-sm font-medium text-gray-700">-</span>
              <img id="userAvatar" src="https://ui-avatars.com/api/?name=User&background=ec4899&color=fff"
                alt="User Avatar" class="w-10 h-10 rounded-full" />
            </div>
          </div>
        </div>
      </header>
      <div class="p-8">
        <div class="max-w-5xl mb-6">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2">
              <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-200 h-full">
                <div>
                  <p class="text-sm text-gray-500">Hasil Deteksi</p>
                  <h2 id="hasil-kategori" class="text-2xl font-extrabold text-gray-800">-</h2>
                  <p class="text-sm text-gray-500 mt-1">
                    Persentase Depresi: <span id="hasil-persentase">-</span>
                  </p>
                </div>
                <p id="hasil-saran" class="mt-4 text-gray-600"></p>
                <p class="mt-3 text-xs text-gray-500 italic">
                  *Ini hanya skrining awal, bukan diagnosis. Jika merasa berisiko, segera hubungi tenaga profesional.
                </p>
              </div>
            </div>
            <div class="lg:col-span-1">
              <div
                class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl shadow-sm p-6 border border-blue-100 h-full flex flex-col justify-between">
                <p class="text-gray-700 leading-relaxed mb-4">
                  Terima kasih sudah memakai sistem ini. Kamu bisa cek riwayat hasil deteksimu di sini.
                </p>
                <button onclick="window.location.href='riwayat-deteksi.html'"
                  class="w-full py-3 bg-[#9090F4] text-white rounded-lg font-semibold hover:bg-[#7a7ae0] transition shadow-lg">
                  Riwayat
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="max-w-5xl">
          <div class="bg-white rounded-2xl shadow-sm p-8 border border-gray-200">
            <h2 class="text-2xl font-bold text-gray-800 mb-8">Hasil Deteksi Kamu</h2>
            <div class="mb-8">
              <h3 class="text-3xl font-bold text-gray-800 mb-2">
                Tingkat Risiko Depresi:
                <span id="riskLabel" class="font-extrabold">-</span>
              </h3>
              <p class="text-gray-600">
                Persentase Depresi:
                <span id="riskScore" class="font-semibold">-</span>
              </p>
            </div>
            <div class="mb-8">
              <h3 class="text-xl font-bold text-gray-800 mb-4">Saran dan Rekomendasi</h3>
              <ol id="rekomList" class="space-y-4 text-gray-700 list-decimal pl-5"></ol>
            </div>
            <div class="bg-blue-50 rounded-lg p-6 border border-blue-100">
              <p class="text-gray-700 leading-relaxed">
                Ikuti saran dan rekomendasi di atas ya ðŸ™‚
                <br />
                Semoga kamu segera merasa lebih baik dan menemukan kembali semangatmu.
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script src="sadar-api.js"></script>
  <script>
    requireAuth();
    const u = getUsername();
    const nameEl = document.getElementById("userName");
    const avatarEl = document.getElementById("userAvatar");
    if (nameEl) nameEl.textContent = u || "-";
    if (avatarEl) {
      avatarEl.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(u || "User")}&background=ec4899&color=fff`;
    }
  </script>
  <script>
    function normalizeRiskLabel(x) {
      const v = String(x || "").toLowerCase();
      if (v.includes("normal")) return "Normal";
      if (v.includes("rendah")) return "Rendah";
      if (v.includes("sedang")) return "Sedang";
      if (v.includes("tinggi") || v.includes("berat")) return "Tinggi";
      return x || "-";
    }
    function riskColorClass(label) {
      if (label === "Normal") return "text-blue-600";
      if (label === "Rendah") return "text-green-600";
      if (label === "Sedang") return "text-yellow-600";
      if (label === "Tinggi") return "text-red-600";
      return "text-gray-800";
    }
    function rekomendasiByRisk(label) {
      if (label === "Normal" || label === "Rendah") {
        return [
          "Pertahankan rutinitas sehat (tidur cukup, makan teratur, minum air yang cukup).",
          "Lakukan aktivitas yang kamu suka secara konsisten (hobi, olahraga ringan, journaling).",
          "Kelola stres dengan istirahat singkat dan teknik napas dalam saat mulai terasa tertekan.",
          "Jaga koneksi sosial: ngobrol dengan teman/keluarga walau sebentar.",
          "Jika gejala mulai mengganggu aktivitas harian, pertimbangkan konsultasi dengan konselor/guru BK."
        ];
      }
      if (label === "Sedang") {
        return [
          "Atur pola tidur & bangun yang konsisten (hindari begadang).",
          "Kurangi beban berlebih: buat daftar prioritas harian, kerjakan yang paling penting dulu.",
          "Ceritakan kondisi kamu ke orang terpercaya (teman dekat/keluarga/guru BK).",
          "Lakukan aktivitas fisik ringan 15-30 menit (jalan, stretching) untuk bantu mood.",
          "Pertimbangkan konsultasi profesional (konselor/psikolog) bila perasaan sedih/cemas berlangsung > 2 minggu."
        ];
      }
      return [
        "Jangan dipendam sendiriâ€”segera cari bantuan dari orang dewasa/teman/keluarga yang kamu percaya.",
        "Pertimbangkan konsultasi profesional (psikolog/psikiater/konselor sekolah) secepatnya.",
        "Kurangi pemicu stres sementara: istirahat, batasi overthinking, dan hindari membandingkan diri di media sosial.",
        "Jaga kebutuhan dasar: makan teratur, tidur cukup, dan tetap minum air.",
        "Jika muncul pikiran menyakiti diri atau merasa tidak aman, segera hubungi layanan darurat setempat / orang terdekat untuk menemani."
      ];
    }
    function computePersentaseFromInput(input) {
      if (!input) return null;
      let total = 0;
      for (let i = 1; i <= 9; i++) {
        const v = Number(input[`q${i}`]);
        if (!isFinite(v)) return null;
        total += v;
      }
      return Math.round((total / 27) * 1000) / 10;
    }
    const hasil = JSON.parse(localStorage.getItem("hasil_deteksi") || "null");
    if (!hasil) window.location.href = "deteksi-depresi.html";
    const label = normalizeRiskLabel(hasil.predicted_class || hasil.label || hasil.risk);
    let persentase =
      (hasil.analysis_score !== undefined && hasil.analysis_score !== null)
        ? Number(hasil.analysis_score)
        : null;
    if (!isFinite(persentase)) persentase = null;
    if (persentase === null) {
      const demografi = JSON.parse(localStorage.getItem("sadar_demografi") || "null");
      const answers = JSON.parse(localStorage.getItem("sadar_answers") || "null");
      if (demografi && Array.isArray(answers) && answers.length === 9) {
        const input = { ...demografi };
        answers.forEach((v, idx) => input[`q${idx + 1}`] = v);
        persentase = computePersentaseFromInput(input);
      }
    }
    const persText = (persentase !== null) ? `${persentase.toFixed(1)}%` : "-";
    const catEl = document.getElementById("hasil-kategori");
    const persEl = document.getElementById("hasil-persentase");
    const saranEl = document.getElementById("hasil-saran");
    if (catEl) catEl.textContent = label;
    if (persEl) persEl.textContent = persText;
    const saranMap = {
      Normal: "Kondisimu terindikasi normal. Tetap jaga pola tidur, aktivitas, dan komunikasi dengan orang terdekat.",
      Rendah: "Terindikasi gejala ringan. Coba atur rutinitas, olahraga ringan, dan ceritakan bebanmu ke orang terpercaya.",
      Sedang: "Terindikasi gejala sedang. Pertimbangkan konsultasi dengan guru BK/psikolog untuk dukungan yang lebih terarah.",
      Tinggi: "Terindikasi gejala tinggi. Sangat disarankan segera mencari bantuan profesional (psikolog/psikiater/layanan krisis)."
    };
    if (saranEl) saranEl.textContent = saranMap[label] || "";
    const riskLabelEl = document.getElementById("riskLabel");
    const riskScoreEl = document.getElementById("riskScore");
    const rekomListEl = document.getElementById("rekomList");
    if (riskLabelEl) {
      riskLabelEl.textContent = label;
      riskLabelEl.className = `font-extrabold ${riskColorClass(label)}`;
    }
    if (riskScoreEl) riskScoreEl.textContent = persText;
    if (rekomListEl) {
      const items = rekomendasiByRisk(label);
      rekomListEl.innerHTML = items.map((x) => `<li class="leading-relaxed">${x}</li>`).join("");
    }
    function confirmLogout() {
      if (confirm("Apakah kamu yakin ingin logout?")) {
        logout();
      }
    }
  </script>
</body>

</html>
